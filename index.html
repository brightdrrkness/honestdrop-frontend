<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HonestDrop Prototype</title>
  <style>
    body {
      background-color: #000;
      font-family: 'Courier New', monospace;
      color: white;
      text-align: center;
      margin: 0;
      overflow-x: hidden;
    }

    .side-img {
      position: fixed;
      top: 0;
      height: 100vh;
      width: auto;
      z-index: -1;
    }
    .left-img { left: 0; }
    .right-img { right: 0; }

    .container {
      width: 520px;
      margin: 40px auto;
      background-color: #222;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 0 25px rgba(0,0,0,0.7);
      position: relative;
      z-index: 10;
    }

    button {
      background-color: #f7931a;
      color: black;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      font-size: 18px;
      padding: 15px 28px;
      width: 300px;
      cursor: pointer;
      margin: 7px auto;
      display: block;
      transition: background-color 0.25s ease;
    }
    button:hover:enabled { background-color: #ffae42; }

    #withdrawButton .speed-subtext {
      font-size: 14px;
      color: #fff;
      display: block;
      margin-top: 2px;
    }

    .button-row { display: flex; justify-content: center; align-items: center; gap: 10px; }
    #coffee { width: 130px; }

    .prototype { font-size: 12px; margin-top: 15px; color: #ddd; line-height: 1.4; }
    .mission-statement { font-size: 10px; margin-top: 5px; }
    #satCounter { margin-top: 8px; font-size: 16px; color: #f7931a; }

    #withdrawOverlay, #withdrawPopup,
    #missionOverlay, #missionPopup,
    #adOverlay, #adPopup,
    #spinnerOverlay, #spinnerPopup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }

    #withdrawOverlay, #missionOverlay, #adOverlay, #spinnerOverlay {
      background: rgba(0,0,0,0.6);
      z-index: 9998;
    }

    #withdrawPopup, #missionPopup, #adPopup, #spinnerPopup {
      background: #222;
      width: 75%; max-width: 700px;
      padding: 35px;
      border: 2px solid #f7931a;
      border-radius: 15px;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      text-align: center;
      overflow-y: auto;
      max-height: 90vh;
    }

    .ad-placeholder {
      border: 2px dashed #555;
      padding: 10px;
      margin-top: 15px;
      color: #bbb;
      font-size: 12px;
      width: 100%;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>

<body>

  <img src="side-coins-left.png" class="side-img left-img">
  <img src="side-coins-right.png" class="side-img right-img">

  <div class="container">
    <img src="logo.png" alt="HonestDrop Logo" width="350" />
    <p>Watch an ad. Get Bitcoin.<br>No quests. No gem packs. No BS.</p>

    <div class="button-row">
      <button id="adButton">‚ñ∂ Watch Ad to Earn Bitcoin</button>
      <img id="coffee" src="bitcoin8bit.png" alt="Coffee Mug" />
    </div>

    <button id="withdrawButton">
      üí∏ Withdraw Bitcoin<br>
      <span class="speed-subtext">Powered by SpeedWallet ‚ö°</span>
    </button>

    <p id="satCounter">Total Earned: 0 sats</p>

    <button id="spinnerButton">üé° Spin & Win (Coming Soon)</button>

    <p class="prototype">
      üîß Prototype Mode: Manual payout + live test.<br>
      ‚è≥ Ad monetization coming soon via Bitstackd.<br>
      ‚òï ‚ÄúOne step at a time. Preferably caffeinated.‚Äù
    </p>

    <button id="popupButton">Caffeine > Logic</button>
    <p class="mission-statement">Mission Statement</p>

    <div class="ad-placeholder">
      üì¢ Ad Space ‚Äì Future Spinner Feature
    </div>
  </div>

  <!-- Ad Popup -->
  <div id="adOverlay"></div>
  <div id="adPopup">
    <h2>üì∫ Ad in Progress</h2>
    <p id="adCountdown" style="font-size:16px;">Ad ends in 5...</p>
    <div class="ad-placeholder">üì¢ Static Ad Placeholder</div>
  </div>

  <!-- Spinner Popup -->
  <div id="spinnerOverlay"></div>
  <div id="spinnerPopup">
    <h2>üé° Spin & Win (Coming Soon)</h2>
    <img src="spinner-comingsoon.png" alt="Spinner Preview" style="width:300px; margin:15px auto; display:block;" />
    <div class="ad-placeholder">üì¢ Ad Space ‚Äì Spinner Popup</div>
    <button onclick="closeSpinner()">Close</button>
  </div>

  <!-- Withdrawal Popup -->
  <div id="withdrawOverlay"></div>
  <div id="withdrawPopup">
    <h2>Withdraw Bitcoin</h2>
    <p style="font-size:13px; line-height:1.4;">
      You‚Äôre in <strong>prototype mode</strong> using <strong>SpeedWallet</strong> for live payouts.<br><br>
      For now, each device can do <strong>one live withdrawal of up to 15 sats</strong> while we line up sponsors.
    </p>

    <p style="font-size:11px; color:#bbb;">
      Works with ANY Lightning-enabled wallet (Wallet of Satoshi, Phoenix, Breez, Cash App, etc.).<br>
      Just create an invoice in your wallet, paste it below, and confirm.
    </p>

    <ol style="text-align:left; font-size:13px; max-width:500px; margin:auto;">
      <li>Generate a Lightning receive invoice in your wallet.</li>
      <li>Paste the invoice below.</li>
      <li>Confirm withdrawal to send your sats.</li>
    </ol>

    <input type="text" id="walletInput" placeholder="Paste your Lightning invoice">
    <br><br>
    <button onclick="processFinalWithdrawal()">Confirm Withdrawal</button>
    <button onclick="closeWithdraw()">Cancel</button>

    <div class="ad-placeholder">
      üì¢ Prime spot for wallet ads ‚Äî especially wallets with "Speed" in the name.<br>
      Where users withdraw their Bitcoin‚Ä¶ just saying üòâ
    </div>
  </div>

  <!-- Mission Statement Popup -->
  <div id="missionOverlay"></div>
  <div id="missionPopup">
    <p style="white-space: pre-line; font-size:14px; line-height:1.5; max-width:600px; margin:0 auto; text-align:left;">

‚ÄúYou clicked this. That‚Äôs on you.‚Äù

‚ÄúHonestDrop exists because your time is valuable ‚Äî and we respect that.
No pointless tasks, no fake mining animations, no tapping virtual rocks pretending you're generating Bitcoin.

Every other ‚ÄòBitcoin game‚Äô is also funded by ad revenue. We‚Äôre just not going to pretend it‚Äôs anything else.

Here, it‚Äôs simple: You watch an ad. You get Bitcoin. No smoke, no mirrors, no gem packs, no energy bars, no BS.

Our goal is to return as much ad revenue to you as possible. We‚Äôre starting with a 50/50 split (because while we love you, we also occasionally need food, electricity, and coffee strong enough to question reality).

As we grow, your share increases. Because this only works if it works for you.

Powered by honesty, coffee strong enough to second-guess life choices, caffeine in general, and whatever‚Äôs on sale at the grocery store.
Not trying to buy a Lambo ‚Äî just keeping it simple, transparent, and honest.

Small drops can make a big difference. Especially when they're honest.‚Äù
    </p>

    <div class="ad-placeholder">üì¢ Ad Space ‚Äì Mission Popup</div>

    <br>
    <button onclick="closeMission()">Back to reality</button>
  </div>

  <script>
    let sats = parseInt(localStorage.getItem("sats") || "0");
    const rewardAmount = 15; // 15 sats per ad (prototype live test)
    const dailyLimit = 10;
    let adCount = parseInt(localStorage.getItem("adCount") || "0");
    let lastReset = parseInt(localStorage.getItem("lastReset") || Date.now());
    let hasWithdrawnLive = localStorage.getItem("hasWithdrawnLive") === "true";

    function resetIfNeeded() {
      if (Date.now() - lastReset > 86400000) {
        adCount = 0;
        localStorage.setItem("adCount", adCount);
        lastReset = Date.now();
        localStorage.setItem("lastReset", lastReset);
      }
    }

    function updateCounter() {
      document.getElementById("satCounter").innerText =
        `Total Earned: ${sats} sats | Ads: ${adCount}/${dailyLimit}`;
    }

    resetIfNeeded();
    updateCounter();

    // Ad button logic
    document.getElementById("adButton").addEventListener("click", () => {
      if (adCount >= dailyLimit) {
        alert("üö´ That's it for today. Faucet needs more caffeine.");
        return;
      }

      document.getElementById("adOverlay").style.display = "block";
      document.getElementById("adPopup").style.display = "block";

      let remaining = 5;
      document.getElementById("adCountdown").innerText = `Ad ends in ${remaining}...`;
      let timer = setInterval(() => {
        remaining--;
        document.getElementById("adCountdown").innerText = `Ad ends in ${remaining}...`;
        if (remaining <= 0) {
          clearInterval(timer);
          closeAdPopup();
          rewardAdWatch();
        }
      }, 1000);
    });

    function closeAdPopup() {
      document.getElementById("adOverlay").style.display = "none";
      document.getElementById("adPopup").style.display = "none";
    }

    function rewardAdWatch() {
      adCount++;
      localStorage.setItem("adCount", adCount);
      sats += rewardAmount;
      localStorage.setItem("sats", sats);
      updateCounter();
      alert(`üéâ +${rewardAmount} sats earned!`);
    }

    // Withdrawal logic
    document.getElementById("withdrawButton").addEventListener("click", () => {
      if (hasWithdrawnLive) {
        alert("Prototype limit reached: you‚Äôve already done your live withdrawal on this device. More coming once sponsors are live.");
        return;
      }
      if (sats < 15) {
        alert("You need at least 15 sats earned before you can withdraw in this prototype.");
        return;
      }
      document.getElementById("withdrawOverlay").style.display = "block";
      document.getElementById("withdrawPopup").style.display = "block";
    });

    function processFinalWithdrawal() {
      let val = document.getElementById("walletInput").value;
      if (!val) {
        alert("Please paste your Lightning invoice first!");
        return;
      }

      // Decide how much to send: up to 15 sats for now
      const payoutAmount = Math.min(sats, 15);

      // Call backend SpeedWallet integration
     fetch("https://honestdrop-backend-1.onrender.com/api/speed-withdraw", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ invoice: val, amount: payoutAmount })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          sats -= payoutAmount;
          if (sats < 0) sats = 0;
          localStorage.setItem("sats", sats);
          hasWithdrawnLive = true;
          localStorage.setItem("hasWithdrawnLive", "true");
          updateCounter();
          alert(`‚ö° Sent ${payoutAmount} sats via SpeedWallet!`);
        } else {
          alert(`‚ùå Withdrawal failed: ${data.error || "Unknown error from backend"}`);
        }
      })
      .catch(() => {
        alert("‚ö† Backend unreachable. The SpeedWallet payout API didn‚Äôt respond.");
      })
      .finally(() => {
        closeWithdraw();
      });
    }

    function closeWithdraw() {
      document.getElementById("withdrawOverlay").style.display = "none";
      document.getElementById("withdrawPopup").style.display = "none";
    }

    // Mission Statement Popup
    document.getElementById("popupButton").addEventListener("click", () => {
      document.getElementById("missionOverlay").style.display = "block";
      document.getElementById("missionPopup").style.display = "block";
    });

    function closeMission() {
      document.getElementById("missionOverlay").style.display = "none";
      document.getElementById("missionPopup").style.display = "none";
    }

    // Spinner popup logic
    document.getElementById("spinnerButton").addEventListener("click", () => {
      document.getElementById("spinnerOverlay").style.display = "block";
      document.getElementById("spinnerPopup").style.display = "block";
    });

    function closeSpinner() {
      document.getElementById("spinnerOverlay").style.display = "none";
      document.getElementById("spinnerPopup").style.display = "none";
    }
  </script>
</body>
</html>
